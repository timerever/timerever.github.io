<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.timerever.tk</id>
    <title>A Blog • Posts by &#34;mysql&#34; category</title>
    <link href="https://blog.timerever.tk" />
    <updated>2022-02-28T06:55:51.000Z</updated>
    <category term="Java" />
    <category term="HttpClient" />
    <category term="Jackson" />
    <category term="Design Pattern" />
    <category term="Docker" />
    <category term="Dockerfile" />
    <category term="Java Web" />
    <category term="Linux" />
    <category term="C" />
    <category term="Android" />
    <category term="Huawei" />
    <category term="CyanogenMod" />
    <category term="Factory Patterns" />
    <category term="Hibernate" />
    <category term="Git" />
    <category term="GitHub" />
    <category term="Kubernetes" />
    <category term="K8s" />
    <category term="K3s" />
    <category term="Keycloak" />
    <category term="OAuth2" />
    <category term="SSO" />
    <category term="VMware" />
    <category term="vmdk" />
    <category term="MySQL" />
    <category term="Tutorial" />
    <category term="wget" />
    <category term="Regular Expression" />
    <category term="Sharding" />
    <category term="Sharding-JDBC" />
    <category term="Translate" />
    <category term="Algorithm" />
    <category term="Sort" />
    <category term="Ubuntu" />
    <category term="Ruby" />
    <category term="Jekyll" />
    <category term="Windows" />
    <category term="Regedit" />
    <category term="PowerShell" />
    <entry>
        <id>https://blog.timerever.tk/2022/02/28/mysql-federated-storage-engine-tutorials/</id>
        <title>MySQL FEDERATED 存储引擎介绍及使用</title>
        <link rel="alternate" href="https://blog.timerever.tk/2022/02/28/mysql-federated-storage-engine-tutorials/"/>
        <content type="html">&lt;p&gt;项目上遇到了一个需求，需要在 MySQL（不同实例）进行跨库 join 操作。我们都知道如果是同一实例，那么 MySQL 跨库查询肯定是没有问题的，但是不同实例的跨库查询之前一直没有做过。不过以前还在用 Oracle 的时候，Oracle 有个功能叫做 DATABASE LINK（参见 &lt;a href=&#34;https://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_5005.htm&#34;&gt;CREATE DATABASE LINK&lt;/a&gt;），是将远程数据库映射到本地，这样就可以在一个实例中访问其他数据库了。在谷歌搜索 MySQL 跨库查询的时候，发现 MySQL 也有类似的东西，叫做 FEDERATED 存储引擎。所以我们就可以使用 FEDERATED 将需要 join 的远端表映射到本地数据库，这样在做查询的时候使用上就跟本地表一样了。&lt;/p&gt;
&lt;p&gt;官方文档：&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/federated-storage-engine.html&#34;&gt;The FEDERATED Storage Engine&lt;/a&gt;&lt;/p&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;h3 id=&#34;federated-表介绍&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#federated-表介绍&#34;&gt;&lt;/a&gt; FEDERATED 表介绍&lt;/h3&gt;
&lt;p&gt;FEDERATED 表在使用上与普通表没有区别，不过 FEDERATED 表只会在本地存储表结构定义而不会直接存储数据，所以在每次查询时数据均需要从远端获取。&lt;br /&gt;
FEDERATED 表支持 DML 语句，DDL 语句只支持 &lt;code&gt;DROP TABLE&lt;/code&gt;，效果为删除本地的 FEDERATED 表。&lt;/p&gt;
&lt;p&gt;官方架构如下：&lt;/p&gt;
&lt;img src=&#34;/2022/02/28/mysql-federated-storage-engine-tutorials/mysql-federated-storage-engine-tutorials-1.png&#34; class=&#34;&#34; title=&#34;FEDERATED 架构&#34;&gt;
&lt;h3 id=&#34;准备工作&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#准备工作&#34;&gt;&lt;/a&gt; 准备工作&lt;/h3&gt;
&lt;p&gt;在使用 FEDERATED 表前，需要先看一下是否满足条件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建 FEDERATED 表的 MySQL 实例需要支持 FEDERATED 引擎，如果是安装的二进制包则没有问题，如果是从源码编译，需要在编译时加上 &lt;code&gt;-DWITH_FEDERATED_STORAGE_ENGINE&lt;/code&gt; 参数&lt;/li&gt;
&lt;li&gt;创建 FEDERATED 表的 MySQL 实例需要打开 FEDERATED 引擎支持，MySQL 默认没有打开，需要在启动时追加 &lt;code&gt;--federated&lt;/code&gt; 命令，或是在配置文件的 &lt;code&gt;[mysqld]&lt;/code&gt; 小节添加 &lt;code&gt;federated&lt;/code&gt; 并重启服务器。可以在 MySQL 中执行 &lt;code&gt;SHOW ENGINES&lt;/code&gt; 语句来查询支持状态&lt;/li&gt;
&lt;li&gt;FEDERATED 表支持的远端数据库只能为 MySQL，同时支持 &lt;code&gt;MyISAM&lt;/code&gt; 和 &lt;code&gt;InnoDB&lt;/code&gt; 存储引擎&lt;/li&gt;
&lt;li&gt;经测试，5.7 版本的数据库连接 8.0 版本会报 SSL 错误，所以建议使用 8.0 版本&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;创建-federated-表&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#创建-federated-表&#34;&gt;&lt;/a&gt; 创建 FEDERATED 表&lt;/h3&gt;
&lt;p&gt;创建 FEDERATED 表有两种方式，但是大同小异，区别只是远端数据库连接是存储在表定义中还是存储到单独的位置。因为 FEDERATED 是表维度，所以为了复用远端连接，建议采用 &lt;code&gt;CREATE SERVER&lt;/code&gt; 的方式创建 FEDERATED表。&lt;/p&gt;
&lt;h4 id=&#34;使用-create-server-的方式创建-federated-表&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#使用-create-server-的方式创建-federated-表&#34;&gt;&lt;/a&gt; 使用 CREATE SERVER 的方式创建 FEDERATED 表&lt;/h4&gt;
&lt;p&gt;首先我们需要先创建远端数据库连接，创建远端连接的格式为：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;CREATE&lt;/span&gt; SERVER&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;server_name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;FOREIGN&lt;/span&gt; DATA WRAPPER wrapper_name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;OPTIONS (option [, option] ...)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;CREATE&lt;/span&gt; SERVER fedlink&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;FOREIGN&lt;/span&gt; DATA WRAPPER mysql&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;OPTIONS (&lt;span class=&#34;keyword&#34;&gt;USER&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;fed_user&amp;#x27;&lt;/span&gt;, PASSWORD &lt;span class=&#34;string&#34;&gt;&amp;#x27;password&amp;#x27;&lt;/span&gt;, HOST &lt;span class=&#34;string&#34;&gt;&amp;#x27;remote_host&amp;#x27;&lt;/span&gt;, PORT &lt;span class=&#34;number&#34;&gt;9306&lt;/span&gt;, DATABASE &lt;span class=&#34;string&#34;&gt;&amp;#x27;federated&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我们需要记住输入的 &lt;code&gt;server_name&lt;/code&gt; 即 fedlink，然后我们需要拿到要创建的源表的表结构，可以使用 &lt;code&gt;SHOW CREATE TABLE table_name&lt;/code&gt; 来打印，然后将 &lt;code&gt;ENGINE&lt;/code&gt; 改为 FEDERATED，添加 &lt;code&gt;CONNECTION=&#39;fedlink/table_name&#39;&lt;/code&gt;，执行后即在本地生成了 FEDERATED 表。例如：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;TABLE&lt;/span&gt; test_table (&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    id     &lt;span class=&#34;type&#34;&gt;INT&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;) &lt;span class=&#34;keyword&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name   &lt;span class=&#34;type&#34;&gt;VARCHAR&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;) &lt;span class=&#34;keyword&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    other  &lt;span class=&#34;type&#34;&gt;INT&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;) &lt;span class=&#34;keyword&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;PRIMARY&lt;/span&gt; KEY  (id),&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    INDEX name (name),&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    INDEX other_key (other)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ENGINE&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;FEDERATED&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;DEFAULT&lt;/span&gt; CHARSET&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;utf8mb4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CONNECTION&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;fedlink/test_table&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里创建的表名即 &lt;code&gt;CREATE TABLE&lt;/code&gt; 后面的表名可以与源表不一样，只需在 &lt;code&gt;CONNECTION&lt;/code&gt; 中指定源表名即可。&lt;/p&gt;
&lt;h4 id=&#34;使用-connection-的方式创建-federated-表&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#使用-connection-的方式创建-federated-表&#34;&gt;&lt;/a&gt; 使用 CONNECTION 的方式创建 FEDERATED 表&lt;/h4&gt;
&lt;p&gt;如果没有 &lt;code&gt;CREATE SERVER&lt;/code&gt; 权限，也可以直接使用 CONNECTION 的方式创建 FEDERATED 表，只需将上面建表语句中 &lt;code&gt;CONNECTION&lt;/code&gt; 的值改为完整连接即可，例如：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;TABLE&lt;/span&gt; federated_table (&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    id     &lt;span class=&#34;type&#34;&gt;INT&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;) &lt;span class=&#34;keyword&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name   &lt;span class=&#34;type&#34;&gt;VARCHAR&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;) &lt;span class=&#34;keyword&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    other  &lt;span class=&#34;type&#34;&gt;INT&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;20&lt;/span&gt;) &lt;span class=&#34;keyword&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;PRIMARY&lt;/span&gt; KEY  (id),&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    INDEX name (name),&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    INDEX other_key (other)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ENGINE&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;FEDERATED&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;DEFAULT&lt;/span&gt; CHARSET&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;utf8mb4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CONNECTION&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;mysql://fed_user@remote_host:9306/federated/test_table&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;需要注意的是：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;采用这种方式创建的 FEDERATED 表，可以通过 &lt;code&gt;SHOW CREATE TABLE&lt;/code&gt; 看到原始的连接信息&lt;/li&gt;
&lt;li&gt;如果密码中包含 &lt;code&gt;@&lt;/code&gt;，由于 &lt;code&gt;@&lt;/code&gt; 需要作为 url 的分界符，所以这种情况下只能使用 &lt;code&gt;CREATE SERVER&lt;/code&gt; 的方式创建 FEDERATED 表&lt;/li&gt;
&lt;/ul&gt;
</content>
        <category term="MySQL" />
        <category term="Tutorial" />
        <updated>2022-02-28T06:55:51.000Z</updated>
    </entry>
</feed>
